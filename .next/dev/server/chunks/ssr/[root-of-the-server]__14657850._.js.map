{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tosib/Downloads/billing-main/billing-main/src/pages/dashboard.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\"\r\nimport { useRouter } from \"next/router\"\r\n\r\ntype Item = {\r\n  id: number\r\n  name: string\r\n  price: number\r\n  category: string\r\n  isActive: boolean\r\n}\r\n\r\ntype CartItem = Item & { qty:number }\r\n\r\nexport default function Dashboard() {\r\n  const router = useRouter()\r\n  const [items, setItems] = useState<Item[]>([])\r\n  const [cart, setCart] = useState<CartItem[]>([])\r\n  const [category, setCategory] = useState(\"REGULAR\")\r\n\r\n  useEffect(() => {\r\n    const user = localStorage.getItem(\"user\")\r\n    if (!user) router.push(\"/login\")\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/items\").then(r=>r.json()).then(setItems)\r\n  }, [])\r\n\r\n  // ADD TO CART\r\n  const addToCart = (item:Item) => {\r\n    setCart(prev => {\r\n      const existing = prev.find(i => i.id === item.id)\r\n      if(existing) return prev.map(i => i.id===item.id ? {...i, qty:i.qty+1} : i)\r\n      return [...prev, {...item, qty:1}]\r\n    })\r\n  }\r\n\r\n  const increaseQty = (id:number) =>\r\n    setCart(prev => prev.map(i => i.id===id ? {...i, qty:i.qty+1} : i))\r\n\r\n  const decreaseQty = (id:number) =>\r\n    setCart(prev => prev\r\n      .map(i => i.id===id ? {...i, qty:i.qty-1} : i)\r\n      .filter(i => i.qty>0)\r\n    )\r\n\r\n  const total = cart.reduce((sum,i)=> sum + i.price*i.qty,0)\r\n\r\n  const categories = [...new Set(items.map(i=>i.category))]\r\n  const filtered = items.filter(i=> i.category===category && i.isActive)\r\n\r\n  // RECEIPT üßæ\r\n  const printReceipt = (mode:string) => {\r\n    const now = new Date()\r\n    const date = now.toLocaleString()\r\n    const txn = \"TXN\" + Date.now()\r\n\r\n    const win = window.open(\"\", \"PRINT\", \"width=300,height=650\")\r\n\r\n    win!.document.write(`\r\n      <html>\r\n      <body style=\"font-family:monospace;padding:10px\">\r\n        <center>\r\n          <h3>ICE SPOT</h3>\r\n          Kurishumood, Changanacherry<br/>\r\n          GSTIN: 32XXXXXXXXXXXX\r\n        </center>\r\n        <hr/>\r\n        Date: ${date}<br/>\r\n        Bill No: ${txn}<br/>\r\n        Payment: ${mode}\r\n        <hr/>\r\n\r\n        ${cart.map(i=>`\r\n          <div style=\"display:flex;justify-content:space-between\">\r\n            <span>${i.name} x${i.qty}</span>\r\n            <span>‚Çπ${i.price*i.qty}</span>\r\n          </div>\r\n        `).join(\"\")}\r\n\r\n        <hr/>\r\n        <h3>Total: ‚Çπ${total}</h3>\r\n        <hr/>\r\n        <center>Thank You ‚ù§Ô∏è<br/>Visit Again</center>\r\n      </body>\r\n      </html>\r\n    `)\r\n\r\n    win!.document.close()\r\n    win!.print()\r\n  }\r\n\r\n  // üí∞ PAYMENT (FINAL FIX ADDED)\r\n  const pay = async (mode:string) => {\r\n    if(cart.length===0) return alert(\"Cart empty\")\r\n\r\n    const user = JSON.parse(localStorage.getItem(\"user\")||\"{}\")\r\n\r\n    await fetch(\"/api/create-sale\",{\r\n      method:\"POST\",\r\n      headers:{ \"Content-Type\":\"application/json\"},\r\n      body:JSON.stringify({\r\n        items: cart,\r\n        total,\r\n        userId: user.id,\r\n        paymentMode: mode   // ‚≠ê IMPORTANT FIX\r\n      })\r\n    })\r\n\r\n    printReceipt(mode)\r\n    setCart([])\r\n  }\r\n\r\n  return (\r\n    <div style={{ display:\"flex\", height:\"100vh\" }}>\r\n      \r\n      {/* MENU */}\r\n      <div style={{ flex:1, padding:20 }}>\r\n        <h2>Menu üç¶</h2>\r\n\r\n        <button onClick={()=>router.push(\"/report\")}\r\n          style={{marginBottom:10,padding:8}}>\r\n          üìä View Today Report\r\n        </button>\r\n\r\n        {categories.map(cat=>(\r\n          <button key={cat} onClick={()=>setCategory(cat)}\r\n            style={{marginRight:10,padding:\"8px 14px\",\r\n            background:cat===category?\"#333\":\"#eee\",\r\n            color:cat===category?\"#fff\":\"#000\",\r\n            borderRadius:20,border:\"none\"}}>\r\n            {cat}\r\n          </button>\r\n        ))}\r\n\r\n        <div style={{display:\"grid\",gridTemplateColumns:\"repeat(4,1fr)\",gap:10,marginTop:20}}>\r\n          {filtered.map(item=>(\r\n            <button key={item.id} onClick={()=>addToCart(item)}\r\n              style={{padding:15,background:\"#f3f3f3\",borderRadius:10}}>\r\n              {item.name}<br/>‚Çπ{item.price}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* CART */}\r\n      <div style={{ width:330,padding:20,borderLeft:\"1px solid #ddd\" }}>\r\n        <h2>Cart üßæ</h2>\r\n\r\n        {cart.map(i=>(\r\n          <div key={i.id} style={{marginBottom:8}}>\r\n            {i.name}\r\n            <div>\r\n              <button onClick={()=>decreaseQty(i.id)}>-</button>\r\n              <b> {i.qty} </b>\r\n              <button onClick={()=>increaseQty(i.id)}>+</button>\r\n              = ‚Çπ{i.price*i.qty}\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n        <hr/>\r\n        <h2>Total: ‚Çπ{total}</h2>\r\n\r\n        <button onClick={()=>pay(\"CASH\")}\r\n          style={{width:\"100%\",padding:12,background:\"green\",color:\"#fff\",marginTop:10}}>\r\n          PAY CASH üíµ\r\n        </button>\r\n\r\n        <button onClick={()=>pay(\"UPI\")}\r\n          style={{width:\"100%\",padding:12,background:\"purple\",color:\"#fff\",marginTop:10}}>\r\n          PAY UPI üì±\r\n        </button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}